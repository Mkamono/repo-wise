<!doctype html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <title>Repo-Wise Manager</title>
</head>

<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">Repo-Wise Manager</h1>
            <p class="text-gray-600">Explore directories and discover documents</p>
        </header>

        <!-- Main workflow container -->
        <div class="max-w-6xl mx-auto space-y-8">
            <!-- Step 1: Directory Explorer -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center mb-4">
                    <span class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">1</span>
                    <h2 class="text-2xl font-semibold text-gray-800">Explore Directory</h2>
                </div>
                <p class="text-gray-600 mb-6">Navigate through your file system to find the directory you want to explore</p>
                
                <!-- Current Path Display -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-600 mb-2">Directory Path</label>
                    <div class="flex items-center gap-2 mb-2">
                        <input type="text" id="directoryPath" placeholder="/absolute/path/to/directory" 
                               class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <button onclick="loadDirectory()" 
                                class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-md whitespace-nowrap font-medium">
                            Explore
                        </button>
                    </div>
                    
                    <!-- Breadcrumb Navigation -->
                    <nav id="breadcrumb" class="flex items-center space-x-1 text-sm text-gray-600 mb-4">
                        <!-- Breadcrumb will be populated here -->
                    </nav>
                </div>

                <!-- Quick Navigation Buttons -->
                <div class="mb-4 flex flex-wrap gap-2">
                    <button onclick="navigateToPath('/')" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded text-sm">Root</button>
                    <button onclick="navigateToPath('/Users')" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded text-sm">Users</button>
                    <button onclick="navigateToPath('/home')" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded text-sm">Home</button>
                    <button onclick="navigateToPath('/tmp')" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded text-sm">Temp</button>
                    <button onclick="goUp()" class="px-3 py-1 bg-yellow-100 hover:bg-yellow-200 rounded text-sm">↑ Up</button>
                </div>

                <!-- Directory Contents -->
                <div id="directoryResults" class="space-y-1 max-h-96 overflow-y-auto border rounded-md">
                    <div class="p-4 text-gray-500 text-center">
                        Enter a path above or click a quick navigation button to start exploring
                    </div>
                </div>
            </div>

            <!-- Step 2: Document Discovery -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center mb-4">
                    <span class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">2</span>
                    <h2 class="text-2xl font-semibold text-gray-800">Discover Documents</h2>
                </div>
                <p class="text-gray-600 mb-6">Find all documents (.md, .txt, etc.) in the selected directory</p>
                
                <div class="mb-4">
                    <div class="flex gap-2">
                        <input type="text" id="documentsPath" placeholder="Path will be auto-filled from directory explorer" 
                               class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 bg-gray-50">
                        <button onclick="searchDocuments()" 
                                class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-md whitespace-nowrap font-medium">
                            Find Documents
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Click on a directory above to auto-fill this path</p>
                </div>

                <!-- Search Results -->
                <div id="documentsResults" class="max-h-96 overflow-y-auto border rounded-md">
                    <div class="p-4 text-gray-500 text-center">
                        Select a directory above and click "Find Documents" to discover files
                    </div>
                </div>

                <!-- Results Summary -->
                <div id="documentsSummary" class="mt-4 text-sm text-gray-600 hidden">
                    <!-- Summary will be displayed here -->
                </div>
            </div>

            <!-- Step 3: Document Content Viewer -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center mb-4">
                    <span class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">3</span>
                    <h2 class="text-2xl font-semibold text-gray-800">View Document Content</h2>
                </div>
                <p class="text-gray-600 mb-6">Read the content of selected documents</p>
                
                <div class="mb-4">
                    <div class="flex gap-2">
                        <input type="text" id="viewDocumentPath" placeholder="Path will be auto-filled when you click a document" 
                               class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 bg-gray-50">
                        <button onclick="loadDocumentContent()" 
                                class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-md whitespace-nowrap font-medium">
                            Load Content
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Click on a document above to auto-fill this path</p>
                </div>

                <!-- Document Content Display -->
                <div id="documentContent" class="max-h-96 overflow-y-auto border rounded-md bg-gray-50">
                    <div class="p-4 text-gray-500 text-center">
                        Select a document above and click "Load Content" to view its content
                    </div>
                </div>

                <!-- Content Info -->
                <div id="contentInfo" class="mt-4 text-sm text-gray-600 hidden">
                    <!-- Content info will be displayed here -->
                </div>
            </div>

            <!-- Step 4: Document Content Editor -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center mb-4">
                    <span class="bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">4</span>
                    <h2 class="text-2xl font-semibold text-gray-800">Edit Document Content</h2>
                </div>
                <p class="text-gray-600 mb-6">Modify and save document content</p>
                
                <div class="mb-4">
                    <div class="flex gap-2">
                        <input type="text" id="editDocumentPath" placeholder="Path will be auto-filled from document viewer" 
                               class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 bg-gray-50">
                        <button onclick="startEditing()" 
                                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md whitespace-nowrap font-medium">
                            Start Editing
                        </button>
                        <button onclick="saveDocumentContent()" 
                                class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-md whitespace-nowrap font-medium">
                            Save Changes
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Load a document in the viewer above to start editing</p>
                </div>

                <!-- Document Content Editor -->
                <div class="mb-4">
                    <textarea id="documentEditor" 
                              class="w-full h-96 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 font-mono text-sm" 
                              placeholder="Document content will appear here when you start editing..."
                              disabled></textarea>
                </div>

                <!-- Save Status -->
                <div id="saveStatus" class="text-sm text-gray-600 hidden">
                    <!-- Save status will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load directory contents
        async function loadDirectory(path) {
            if (!path) {
                path = document.getElementById('directoryPath').value;
            }
            
            if (!path) {
                alert('Please enter a directory path');
                return;
            }

            // Update the input field
            document.getElementById('directoryPath').value = path;

            try {
                const response = await fetch(`/directory?path=${encodeURIComponent(path)}&kind=local`);
                const data = await response.json();
                
                const resultsDiv = document.getElementById('directoryResults');
                
                if (response.ok) {
                    updateBreadcrumb(path);
                    
                    resultsDiv.innerHTML = data.items
                        .sort((a, b) => {
                            // Sort directories first, then files, both alphabetically
                            if (a.is_dir && !b.is_dir) return -1;
                            if (!a.is_dir && b.is_dir) return 1;
                            return a.name.localeCompare(b.name);
                        })
                        .map(item => `
                            <div class="flex items-center p-3 hover:bg-gray-50 border-b last:border-b-0 cursor-pointer ${item.is_dir ? 'hover:bg-blue-50' : ''}" 
                                 onclick="${item.is_dir ? `selectDirectory('${path}/${item.name}')` : ''}">
                                <span class="mr-3 text-lg">${item.is_dir ? '📁' : getFileIcon(item.name)}</span>
                                <span class="font-medium flex-1 ${item.is_dir ? 'text-blue-700' : 'text-gray-700'}">${item.name}</span>
                                <span class="text-sm text-gray-500">${item.is_dir ? 'Directory' : 'File'}</span>
                                ${item.is_dir ? '<button onclick="event.stopPropagation(); updateDocumentsPath(\'' + path + '/' + item.name + '\')" class="ml-2 px-2 py-1 bg-green-100 hover:bg-green-200 rounded text-xs text-green-700">Use for Documents</button>' : ''}
                            </div>
                        `).join('');
                } else {
                    resultsDiv.innerHTML = `<div class="text-red-600 p-4 text-center">Error: ${data.detail || 'Failed to load directory'}</div>`;
                }
            } catch (error) {
                document.getElementById('directoryResults').innerHTML = `<div class="text-red-600 p-4 text-center">Error: ${error.message}</div>`;
            }
        }

        // Select directory for navigation
        function selectDirectory(path) {
            navigateToPath(path);
        }

        // Update documents path input
        function updateDocumentsPath(path) {
            document.getElementById('documentsPath').value = path;
            // Highlight the documents section briefly
            const documentsSection = document.querySelector('#documentsPath').closest('.bg-white');
            documentsSection.classList.add('ring-2', 'ring-green-500');
            setTimeout(() => {
                documentsSection.classList.remove('ring-2', 'ring-green-500');
            }, 2000);
        }

        // Navigate to specific path
        function navigateToPath(path) {
            // Clean up the path
            const cleanPath = path.replace(/\/+/g, '/').replace(/\/$/, '') || '/';
            loadDirectory(cleanPath);
        }

        // Go up one directory level
        function goUp() {
            const currentPath = document.getElementById('directoryPath').value;
            if (currentPath && currentPath !== '/') {
                const parentPath = currentPath.split('/').slice(0, -1).join('/') || '/';
                navigateToPath(parentPath);
            }
        }

        // Update breadcrumb navigation
        function updateBreadcrumb(path) {
            const breadcrumbDiv = document.getElementById('breadcrumb');
            const pathParts = path.split('/').filter(part => part !== '');
            
            let breadcrumbHTML = '<button onclick="navigateToPath(\'/\')" class="hover:text-blue-600 font-medium">/</button>';
            
            let currentPath = '';
            for (let i = 0; i < pathParts.length; i++) {
                currentPath += '/' + pathParts[i];
                const isLast = i === pathParts.length - 1;
                
                breadcrumbHTML += `
                    <span class="text-gray-400">/</span>
                    <button onclick="navigateToPath('${currentPath}')" 
                            class="${isLast ? 'font-semibold text-gray-800' : 'hover:text-blue-600'}">${pathParts[i]}</button>
                `;
            }
            
            breadcrumbDiv.innerHTML = breadcrumbHTML;
        }

        // Get file icon based on extension
        function getFileIcon(filename) {
            const extension = filename.split('.').pop().toLowerCase();
            const iconMap = {
                'js': '📄',
                'ts': '📄',
                'py': '🐍',
                'go': '🔷',
                'java': '☕',
                'html': '🌐',
                'css': '🎨',
                'json': '📋',
                'md': '📝',
                'txt': '📄',
                'pdf': '📕',
                'img': '🖼️',
                'jpg': '🖼️',
                'jpeg': '🖼️',
                'png': '🖼️',
                'gif': '🖼️',
                'zip': '📦',
                'tar': '📦',
                'gz': '📦'
            };
            return iconMap[extension] || '📄';
        }


        // Search for documents using documents API
        async function searchDocuments() {
            const path = document.getElementById('documentsPath').value;
            if (!path) {
                alert('Please select a directory path');
                return;
            }

            const resultsDiv = document.getElementById('documentsResults');
            const summaryDiv = document.getElementById('documentsSummary');
            
            // Show loading state
            resultsDiv.innerHTML = '<div class="p-4 text-center text-gray-600">🔍 Searching for documents...</div>';
            summaryDiv.classList.add('hidden');

            try {
                const response = await fetch(`/documents?path=${encodeURIComponent(path)}&kind=local`);
                const data = await response.json();
                
                if (response.ok) {
                    const documents = data.documents || [];
                    
                    if (documents.length === 0) {
                        resultsDiv.innerHTML = '<div class="p-4 text-center text-gray-500">No documents found in this directory</div>';
                        summaryDiv.classList.add('hidden');
                    } else {
                        // Convert documents to files format for existing display logic
                        const files = documents.map(doc => ({
                            name: doc.name.split('/').pop() || doc.name,
                            relative_path: doc.name,
                            absolute_path: doc.path,
                            extension: getFileExtension(doc.name)
                        }));
                        
                        // Build directory tree structure
                        const tree = buildFileTree(files);
                        const treeHTML = renderFileTree(tree, 0);
                        
                        resultsDiv.innerHTML = `
                            <div class="p-3">
                                <div class="text-sm">
                                    ${treeHTML}
                                </div>
                            </div>
                        `;
                        
                        // Show summary
                        summaryDiv.innerHTML = `Found ${documents.length} documents in ${path}`;
                        summaryDiv.classList.remove('hidden');
                    }
                } else {
                    resultsDiv.innerHTML = `<div class="text-red-600 p-4 text-center">Error: ${data.detail || 'Failed to search documents'}</div>`;
                    summaryDiv.classList.add('hidden');
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="text-red-600 p-4 text-center">Error: ${error.message}</div>`;
                summaryDiv.classList.add('hidden');
            }
        }

        // Get file extension from filename
        function getFileExtension(filename) {
            const parts = filename.split('.');
            return parts.length > 1 ? '.' + parts.pop() : '';
        }

        // Build file tree structure from flat file list
        function buildFileTree(files) {
            const tree = {};
            
            files.forEach(file => {
                const pathParts = file.relative_path.split('/').filter(part => part !== '');
                let currentLevel = tree;
                
                // Build directory structure
                for (let i = 0; i < pathParts.length - 1; i++) {
                    const dirName = pathParts[i];
                    if (!currentLevel[dirName]) {
                        currentLevel[dirName] = { type: 'directory', children: {} };
                    }
                    currentLevel = currentLevel[dirName].children;
                }
                
                // Add the file
                const fileName = pathParts[pathParts.length - 1];
                currentLevel[fileName] = {
                    type: 'file',
                    data: file
                };
            });
            
            return tree;
        }

        // Render file tree as HTML with proper indentation
        function renderFileTree(tree, depth = 0) {
            const entries = Object.entries(tree);
            let html = '';
            
            entries.forEach(([name, node], index) => {
                const isLast = index === entries.length - 1;
                const connector = isLast ? '└── ' : '├── ';
                const indentSpaces = '&nbsp;&nbsp;&nbsp;&nbsp;'.repeat(depth);
                const pipeSpaces = depth > 0 ? '│&nbsp;&nbsp;&nbsp;'.repeat(depth) : '';
                const currentPrefix = depth > 0 ? (isLast ? indentSpaces : pipeSpaces) : '';
                
                if (node.type === 'directory') {
                    html += `
                        <div class="text-blue-600 hover:bg-blue-50 py-1 px-2 rounded cursor-pointer" onclick="toggleDirectory(this)" style="padding-left: ${depth * 20 + 8}px;">
                            <span class="font-mono">${currentPrefix}${connector}</span>📁 <span class="font-medium">${name}/</span>
                        </div>
                        <div class="directory-content">
                            ${renderFileTree(node.children, depth + 1)}
                        </div>
                    `;
                } else {
                    const file = node.data;
                    const icon = getFileIcon(file.name);
                    const extensionColor = getExtensionColor(file.extension);
                    
                    html += `
                        <div class="text-gray-700 hover:bg-gray-50 py-1 px-2 rounded flex items-center group" style="padding-left: ${depth * 20 + 8}px;">
                            <span class="font-mono">${currentPrefix}${connector}</span>
                            <span>${icon} </span>
                            <span class="font-medium ${extensionColor} cursor-pointer hover:underline" onclick="selectDocumentForViewing('${file.absolute_path}')">${file.name}</span>
                            <button onclick="copyPath('${file.absolute_path}')" 
                                    class="ml-2 px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded text-xs opacity-0 group-hover:opacity-100 transition-opacity"
                                    title="Copy absolute path">
                                📋
                            </button>
                            <button onclick="selectDocumentForViewing('${file.absolute_path}')" 
                                    class="ml-1 px-2 py-1 bg-purple-100 hover:bg-purple-200 rounded text-xs opacity-0 group-hover:opacity-100 transition-opacity text-purple-700"
                                    title="View content">
                                👁️
                            </button>
                        </div>
                    `;
                }
            });
            
            return html;
        }

        // Toggle directory visibility
        function toggleDirectory(element) {
            const content = element.nextElementSibling;
            if (content && content.classList.contains('directory-content')) {
                content.style.display = content.style.display === 'none' ? 'block' : 'none';
                
                // Update folder icon
                const folderIcon = element.querySelector('span');
                if (folderIcon) {
                    folderIcon.innerHTML = folderIcon.innerHTML.includes('📁') 
                        ? folderIcon.innerHTML.replace('📁', content.style.display === 'none' ? '📁' : '📂')
                        : folderIcon.innerHTML.replace('📂', '📁');
                }
            }
        }

        // Get color based on file extension
        function getExtensionColor(extension) {
            const colorMap = {
                '.md': 'text-blue-600',
                '.txt': 'text-green-600',
                '': 'text-purple-600'
            };
            return colorMap[extension] || 'text-gray-600';
        }

        // Copy path to clipboard
        async function copyPath(path) {
            try {
                await navigator.clipboard.writeText(path);
                // Show temporary feedback
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '✓';
                button.classList.add('bg-green-100');
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-green-100');
                }, 1000);
            } catch (err) {
                alert('Failed to copy to clipboard');
            }
        }

        // Select document for viewing
        function selectDocumentForViewing(path) {
            document.getElementById('viewDocumentPath').value = path;
            // Highlight the viewer section briefly
            const viewerSection = document.querySelector('#viewDocumentPath').closest('.bg-white');
            viewerSection.classList.add('ring-2', 'ring-purple-500');
            setTimeout(() => {
                viewerSection.classList.remove('ring-2', 'ring-purple-500');
            }, 2000);
        }

        // Load document content
        async function loadDocumentContent() {
            const path = document.getElementById('viewDocumentPath').value;
            if (!path) {
                alert('Please select a document path');
                return;
            }

            const contentDiv = document.getElementById('documentContent');
            const infoDiv = document.getElementById('contentInfo');
            
            // Show loading state
            contentDiv.innerHTML = '<div class="p-4 text-center text-gray-600">📖 Loading document content...</div>';
            infoDiv.classList.add('hidden');

            try {
                const response = await fetch(`/document/content?path=${encodeURIComponent(path)}&kind=local`);
                const data = await response.json();
                
                if (response.ok) {
                    // Display content in a formatted way
                    const content = data.content || '';
                    const lines = content.split('\n').length;
                    const chars = content.length;
                    
                    contentDiv.innerHTML = `
                        <div class="p-4">
                            <pre class="whitespace-pre-wrap text-sm text-gray-800 leading-relaxed">${escapeHtml(content)}</pre>
                        </div>
                    `;
                    
                    // Show info
                    infoDiv.innerHTML = `Document loaded: ${lines} lines, ${chars} characters`;
                    infoDiv.classList.remove('hidden');
                    
                    // Auto-fill editor path
                    document.getElementById('editDocumentPath').value = path;
                } else {
                    contentDiv.innerHTML = `<div class="text-red-600 p-4 text-center">Error: ${data.detail || 'Failed to load document content'}</div>`;
                    infoDiv.classList.add('hidden');
                }
            } catch (error) {
                contentDiv.innerHTML = `<div class="text-red-600 p-4 text-center">Error: ${error.message}</div>`;
                infoDiv.classList.add('hidden');
            }
        }

        // Start editing document
        function startEditing() {
            const path = document.getElementById('editDocumentPath').value;
            if (!path) {
                // Try to get path from viewer
                const viewerPath = document.getElementById('viewDocumentPath').value;
                if (viewerPath) {
                    document.getElementById('editDocumentPath').value = viewerPath;
                    loadDocumentForEditing(viewerPath);
                } else {
                    alert('Please select a document to edit');
                }
                return;
            }
            loadDocumentForEditing(path);
        }

        // Load document for editing
        async function loadDocumentForEditing(path) {
            const editor = document.getElementById('documentEditor');
            const statusDiv = document.getElementById('saveStatus');
            
            // Show loading state
            editor.value = 'Loading document content...';
            editor.disabled = true;
            statusDiv.classList.add('hidden');

            try {
                const response = await fetch(`/document/content?path=${encodeURIComponent(path)}&kind=local`);
                const data = await response.json();
                
                if (response.ok) {
                    editor.value = data.content || '';
                    editor.disabled = false;
                    editor.focus();
                    
                    statusDiv.innerHTML = `Editing: ${path}`;
                    statusDiv.classList.remove('hidden');
                    
                    // Highlight the editor section briefly
                    const editorSection = document.querySelector('#editDocumentPath').closest('.bg-white');
                    editorSection.classList.add('ring-2', 'ring-orange-500');
                    setTimeout(() => {
                        editorSection.classList.remove('ring-2', 'ring-orange-500');
                    }, 2000);
                } else {
                    editor.value = '';
                    editor.disabled = true;
                    statusDiv.innerHTML = `Error: ${data.detail || 'Failed to load document for editing'}`;
                    statusDiv.classList.remove('hidden');
                }
            } catch (error) {
                editor.value = '';
                editor.disabled = true;
                statusDiv.innerHTML = `Error: ${error.message}`;
                statusDiv.classList.remove('hidden');
            }
        }

        // Save document content
        async function saveDocumentContent() {
            const path = document.getElementById('editDocumentPath').value;
            const content = document.getElementById('documentEditor').value;
            const statusDiv = document.getElementById('saveStatus');
            
            if (!path) {
                alert('No document selected for editing');
                return;
            }

            // Show saving state
            statusDiv.innerHTML = 'Saving document...';
            statusDiv.classList.remove('hidden');

            try {
                const response = await fetch(`/document/content?path=${encodeURIComponent(path)}&kind=local`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ content: content })
                });

                const data = await response.json();
                
                if (response.ok) {
                    statusDiv.innerHTML = `✅ ${data.message} (${new Date().toLocaleTimeString()})`;
                    statusDiv.classList.add('text-green-600');
                    statusDiv.classList.remove('text-red-600');
                    
                    // Refresh viewer if it's showing the same document
                    const viewerPath = document.getElementById('viewDocumentPath').value;
                    if (viewerPath === path) {
                        loadDocumentContent();
                    }
                } else {
                    statusDiv.innerHTML = `❌ Error: ${data.detail || 'Failed to save document'}`;
                    statusDiv.classList.add('text-red-600');
                    statusDiv.classList.remove('text-green-600');
                }
            } catch (error) {
                statusDiv.innerHTML = `❌ Error: ${error.message}`;
                statusDiv.classList.add('text-red-600');
                statusDiv.classList.remove('text-green-600');
            }
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Auto-load current directory path suggestion
        document.addEventListener('DOMContentLoaded', function() {
            // Set default directory path to home directory
            document.getElementById('directoryPath').value = '/Users';
            
            // Add Enter key support for directory input
            document.getElementById('directoryPath').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loadDirectory();
                }
            });

            // Add Enter key support for documents search
            document.getElementById('documentsPath').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchDocuments();
                }
            });

            // Add Enter key support for document viewer
            document.getElementById('viewDocumentPath').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loadDocumentContent();
                }
            });

            // Add Ctrl+S support for saving in editor
            document.getElementById('documentEditor').addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    saveDocumentContent();
                }
            });
        });
    </script>
</body>

</html>
